<!DOCTYPE html>
<!-- Exemplo 1-1 "Uma calculadora de empréstimos", do livro JavaScript: O Guia Definitivo  -->
<html>
  <head>
    <title>JavaScript Loan Calculator</title>
    <style> /* Este é uma folha de estilos CSS: ela adiciona estilo na saĩda do programa */
      .output { font-weight: bold;}             /* Valor calculados em negrito */
      #payment { text-decoration: underline;}   /* Para elemento com id="payment"*/
      #graph { border: solid black 1px;}        /* O gráfico tem borda simples */
      th, td { vertical-align: top;}            /* Não centraliza células da tabela */
    </style>
  </head>

  <body>
    <!--
      Esta é uam tabela HTML com elementos <input> que permitem ao usuário inserir dados e
      elementos <span> nos quais o programa pode exibir seus resultados. Esses elementos têm
      identificações como "interest" e "years". Essas identificações são usadas no código
      JavaScript que vem após a tabela. Note que alguns dos elementos de entrada definem
      rotinas de tratamento de evento "onchange" ou "onclick". Elas especificam strings de
      código JavaScript a ser executado quando o usuário insere dados ou dá um clique.
    -->
    <table>
      <tr><th>Enter Loan Data:</th>
        <td></td>
        <th>Loan Balance, Cumulative Equity, and Interest Payments</th></tr>
      <tr><td>Amount of the loan ($):</td>
          <td><input id="amount" onchange="calculate();"></td>
          <td rowspan=8>
            <canvas id="graph" width="400" height="250"></canvas></td></tr>
      <tr><td>Annual interest (%):</td>
          <td><input id="apr" onchange="calculate();"></td></tr>
      <tr><td>Repayment period (years):</td>
          <td><input id="years" onchange="calculate();"></td></tr>
      <tr><td>Zipcode (to find lenders):</td>
          <td><input id="zipcode" onchange="calculate();"></td></tr>
      <tr><th>Approximate Payments:</th>
          <td><button onclick="calculate();">Calculate</button></td></tr>
      <tr><td>Monthly payment:</td>
          <td>$<span class="output" id="payment"></span></td></tr>
      <tr><td>Total payment:</td>
          <td>$<span class="output" id="total"></span></td></tr>
      <tr><td>Toal interest:</td>
          <td>$<span class="output" id="totalinterest"></span></td></tr>
      <tr><th>Sponsors:</th><td colspan=2>
        Apply for your loan with one of these fine lenders:
        <div id="lenders"></div></td></tr>
    </table>

    <!-- The rest of this exemple is JavaScript code in the <script> tag below -->
    <!-- Normally, this script would go in the document <head> above but it -->
    <!-- is easier to undestand here, after you've seen its HTML context. -->
    <script>
    "use strict"; //Use ECMAScript 5 strict mode in browsers that suport it

    /*
     * This script difines the calculate() function called by the event handlers
     * in HTML above. The function reads values from <input> elements, calculates
     * loan payment information, displays the results in <span> elements. It also
     * saves the user's data, displays links to lendrs, and draws a chart.
    */
    function calculate() {
      // Look up the input and output elements in the document
      var amount = document.getElementById("amount");
      var apr = document.getElementById("apr");
      var years = document.getElementById("years");
      var zipcode = document.getElementById("zipcode");
      var payment = document.getElementById("payment");
      var total = document.getElementById("total");
      var totalinterest = document.getElementById("totalinterest");

      // Get the user's input from the input elements. Assume it is all valid.
      // Convert interest from a percentage to a decimal, and convert from
      // an annual rate to a monthly rate. Convert payment period in years
      // to the number of monthly payment.
      var principal = parseFloat(amount.value);
      var interest = parseFloat(apr.value) /100 /12;
      var payments = parseFloat(years.value) * 12;

      // Now compute the monthly payment figure.
      var x = Math.pow(1 + interest, payments); // Math.pow() computes powers
      var monthly = (principal*x*interest)/(x-1);

      // If the result is a finite number, the user's input was good and
      // we have meaningful results to display
      if (isFinite(monthly)) {
        // Fill in the output fields, rounding to 2 dicimal places
        payment.innerHTML = monthly.toFixed(2);
        total.innerHTML = (monthly * pay)
      }
    }
    </script>
  </body>

</html>
